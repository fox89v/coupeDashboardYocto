MACHINE ?= "qemuarm64"
PACKAGE_CLASSES = "package_ipk"


BB_NUMBER_THREADS = "${@max(1, oe.utils.cpu_count() - 1)}"
PARALLEL_MAKE = "-j${@max(1, oe.utils.cpu_count() - 1)}"
BB_TASK_MEMORY = "12000"
BB_PRESSURE_MAX_CPU = "2600"
BB_PRESSURE_MAX_IO = "2600"
BB_PRESSURE_MAX_MEM = "2600"

# Mirror alternativi
# â”€â”€ Mirrors robusti (coppie: pattern -> mirror) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INHERIT += "own-mirrors"
SOURCE_MIRROR_URL = "http://mirror.yoctoproject.org/sources/"

MIRRORS = "\
    git://.*/.*            http://mirror.yoctoproject.org/sources/ \n \
    ftp://.*/.*            http://mirror.yoctoproject.org/sources/ \n \
    http://.*/.*           http://mirror.yoctoproject.org/sources/ \n \
    https://.*/.*          http://mirror.yoctoproject.org/sources/ \n \
    http://download.savannah.gnu.org/releases/  http://mirror.yoctoproject.org/sources/ \n \
    https://download.savannah.gnu.org/releases/ http://mirror.yoctoproject.org/sources/ \n \
    http://ftp.gnu.org/gnu/    http://mirror.yoctoproject.org/sources/ \n \
    https://ftp.gnu.org/gnu/   http://mirror.yoctoproject.org/sources/ \n \
    http://fontconfig.org/release/  http://mirror.yoctoproject.org/sources/ \n \
    https://cdn.kernel.org/         http://mirror.yoctoproject.org/sources/ \n \
    http://www.thrysoee.dk/editline/ http://mirror.yoctoproject.org/sources/ \n \
"

INHERIT += "rm_work"
RM_OLD_WORK = "1"

# ðŸ§© libc leggera
TCLIBC = "musl"
ASSUME_PROVIDED += "nss-native"


# ðŸ§± features minime ma con EGLFS
DISTRO_FEATURES:append = " opengl egl kms"
DISTRO_FEATURES:remove = " x11 wayland nfs bluetooth wifi systemd-boot"


# ðŸ’¨ niente splash, niente package-management
IMAGE_FEATURES = ""
IMAGE_FEATURES:remove = "splash package-management debug-tweaks"

# âš™ï¸ console silenziosa e boot rapido
APPEND += "quiet loglevel=0 vt.global_cursor_default=0 raid=noautodetect"
SERIAL_CONSOLE = "115200;ttyAMA0"
QUIET_CONSOLE = "1"

# ðŸ§¹ disabilita logging persistente e roba inutile
VOLATILE_LOG_DIR = "yes"

# ðŸ§° cache condivisa
SSTATE_DIR ?= "${TOPDIR}/../sstate-cache"
DL_DIR ?= "${TOPDIR}/../downloads"

# âš ï¸ accetta licenze proprietarie (firmware RPi)
LICENSE_FLAGS_ACCEPTED += "synaptics-killswitch"

# ðŸ§© QEMU SDL (solo per test grafici)
PACKAGECONFIG:append_pn-qemu-native = " sdl"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸŽ¨ Qt6 completo (EGLFS + QML + Controls + Multimedia)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# usa EGLFS, niente X11 o Wayland
DISTRO_FEATURES:append = " opengl egl"
DISTRO_FEATURES:remove = " x11 wayland"

PACKAGECONFIG:append_pn-qtbase = " gles2 eglfs"
PACKAGECONFIG:append_pn-qtdeclarative = " quick quickcontrols2 tools"

# pacchetti principali Qt grafici
IMAGE_INSTALL:append = " qtbase qtdeclarative qtmultimedia qtshadertools sapp"

# forza git:// -> https:// per i repo Qt
BB_FETCH_PREMIRRORS:prepend = " \
    git://code.qt.io/qt/ https://code.qt.io/qt/ \n \
"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸš« BLACKLIST dÃ¬ Quick3D
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PACKAGE_EXCLUDE += "qtquick3dphysics"
PACKAGE_EXCLUDE += "qtquick3dparticleeffects"
PACKAGE_EXCLUDE += "qtquick3dspatialaudio"
PACKAGE_EXCLUDE += "qtquick3d-assimp"
PACKAGE_EXCLUDE += "qtquick3d-tools"

SDKIMAGE_FEATURES:append = " staticdev-pkgs"


EXTRA_IMAGE_FEATURES += "debug-tweaks"
